<html>
    <head>
        <link type="text/css" rel="stylesheet" href="css/index.css">
        <script src="https://apis.google.com/js/platform.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script> 
        <script src="https://cdn.jsdelivr.net/jquery.validation/1.16.0/jquery.validate.min.js"></script>
        <script src="https://unpkg.com/react@16/umd/react.production.min.js" crossorigin></script>
        <script src="https://unpkg.com/react-dom@16/umd/react-dom.production.min.js" crossorigin></script>
        <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script><!--FOR JSX-->
        <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    </head>
    <body>
        <div class="menu-bar">
            <a href="/">
                <div id="site-title">aramuk/login</div>
            </a>
            <div id='uname' class='log redirect' style='width: 120px;'></div>
            <div class='dropdown'></div>
        </div>
        <div id='content' class='content'></div>
        <script type='text/babel'>

        class UserData extends React.Component{
            state = {
                first: '',
                last: '',
                dob: ''
            }

            componentDidMount() {
                axios.get('http://localhost:8000/loadData').then(res => {
                    const info = res.data;
                    this.setState({
                        first: info.fname,
                        last: info.lname,
                        dob: info.bday
                    });
                });
            };

            render() {
                return (
                    <div>
                        <p>Welcome {this.state.first} {this.state.last}!</p>
                        <p>Born: {this.state.dob}</p>
                    </div>
                );
            };
        };

        ReactDOM.render(
            <UserData />,
            document.getElementById('content')
        );

            $(window).on('load', function(){
                $.get('/loadData', function(data){
                    if(data.fname == null){
                        data = {
                            fname: "Your",
                            lname: "Account"
                        }
                    }

                    function DropdownContent(){
                        return (
                            <span>
                                <div class='portrait'>{data.fname[0]}</div>
                                <a id='edit' class='redirect p-nav'>Edit Profile</a>
                                <a class='redirect p-nav' href='/logout'>Log Out</a>
                            </span>
                        );
                    };

                    function Name(){
                        return (
                            <span>{data.fname} {data.lname}</span>   
                        );
                    };

                    ReactDOM.render(
                        DropdownContent(),
                        document.getElementsByClassName('dropdown')[0]
                    )

                    ReactDOM.render(
                        Name(),
                        document.getElementById('uname')
                    );
                });
            });

            $('#uname').click(function(){
                if($('.dropdown').is(':visible')){
                    $('.dropdown').css({'display':'none'});
                }
                else{
                    $('.dropdown').css({'display':'block'});
                }
            });

            $('#edit').click(function(){
                $.get('/editaccount', function(data){
                    $('.content').append(data);
                    $('.dropdown').css({'display':'none'});
                    $.get('/loadData', function(data){
                        if(data.fname == null){
                            data = {
                                fname: "Your",
                                lname: "Account",
                                
                            }
                        }
                        if(data.bday == null){
                            data.bday = "00/00/0000"
                        }
                        $('#fname').val(data.fname);
                        $('#lname').val(data.lname);
                        $('#bday').val(data.bday);
                    });
                });
            });

            $('#submit').click(function(){
                $('#editAccount').submit();
                console.log('HI');
            });
        </script>
    </body>
</html>